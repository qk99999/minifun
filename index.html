<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7FVB8NG111"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-7FVB8NG111');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiNiFun - Play Free Online Games | 小游戏聚合站</title>
    <meta name="description" content="MiNiFun is your go-to platform for free online games. Browse our collection of action, puzzle, strategy, and adventure games to play right in your browser.">
    <link rel="canonical" href="https://minifun.vip/" />
    <meta name="keywords" content="MiNiFun, online games, free games, browser games, action games, puzzle games, strategy games">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        apple: {
                            blue: '#007AFF',
                            green: '#34C759',
                            red: '#FF3B30',
                            orange: '#FF9500',
                            yellow: '#FFCC00',
                            purple: '#AF52DE',
                            pink: '#FF2D55',
                            gray: '#8E8E93'
                        }
                    }
                }
            }
        }
    </script>
    <!-- Google fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .game-card {
            transition: transform 0.3s ease;
        }
        .game-card:hover {
            transform: translateY(-5px);
        }
        .game-container {
            aspect-ratio: 16/9;
            max-height: 70vh;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        @media (max-width: 768px) {
            .mobile-menu {
                display: block;
            }
        }
        @media (min-width: 769px) {
            .mobile-menu {
                display: none;
            }
        }
        #mobile-nav {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50">
    <header class="bg-gradient-to-r from-apple-blue to-apple-purple text-white shadow-md">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center">
                    <div class="text-2xl font-bold mr-4">
                        <a href="#" id="logo-link">MiNiFun</a>
                    </div>
                    <div class="mobile-menu md:hidden">
                        <button class="text-white text-xl" id="mobile-menu-button">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </div>
                <div class="hidden md:flex space-x-4">
                    <a href="#" class="text-white hover:text-gray-200">Home</a>
                    <a href="#" class="text-white hover:text-gray-200">Popular</a>
                    <a href="#" class="text-white hover:text-gray-200">New Games</a>
                    <a href="#" class="text-white hover:text-gray-200">Contact</a>
                </div>
                <div class="md:hidden">
                    <!-- 移除移动版语言切换按钮和菜单 -->
                </div>
            </div>
            
            <!-- 添加移动端导航菜单 -->
            <div id="mobile-nav" class="hidden md:hidden bg-white rounded-lg shadow-md p-4 mb-4 absolute top-24 left-4 right-4 z-50">
                <nav class="flex flex-col space-y-2">
                    <a href="#" class="text-gray-700 hover:text-apple-blue py-2 border-b border-gray-100">Home</a>
                    <a href="#" class="text-gray-700 hover:text-apple-blue py-2 border-b border-gray-100">Popular</a>
                    <a href="#" class="text-gray-700 hover:text-apple-blue py-2 border-b border-gray-100">New Games</a>
                    <a href="#" class="text-gray-700 hover:text-apple-blue py-2">Contact</a>
                </nav>
            </div>
            
            <!-- Search Bar -->
            <div class="max-w-2xl mx-auto mb-8">
                <div class="relative flex items-center">
                    <input type="text" 
                           id="search-input"
                           placeholder="Search games..." 
                           class="w-full px-5 py-3 rounded-full text-gray-700 focus:outline-none focus:ring-2 focus:ring-apple-blue">
                    <button class="absolute right-3 text-gray-500" id="search-button">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            
            <h1 class="text-3xl md:text-5xl font-bold text-center mb-4">MiNiFun Games</h1>
            <p class="text-center text-xl max-w-3xl mx-auto">Your ultimate destination for free online games!</p>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8 flex flex-wrap">
        <!-- 移除侧边栏，主内容区占满宽度 -->
        <main class="w-full">
            <!-- Game Categories Grid - 移到所有游戏上面 -->
            <section class="mb-8">
                <h2 class="text-2xl font-bold mb-6 text-apple-blue">Game Categories</h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-7 gap-3" id="category-cards">
                    <!-- Category cards will be loaded dynamically -->
                </div>
            </section>
            
            <!-- All Games Section -->
            <section class="mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-apple-blue">All Games</h2>
                    <div class="flex space-x-2">
                        <button id="grid-view-btn" class="bg-apple-blue text-white px-3 py-1 rounded text-sm">
                            <i class="fas fa-th"></i>
                        </button>
                        <button id="list-view-btn" class="bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="all-games">
                    <!-- All games will be loaded dynamically -->
                </div>
            </section>
            
            <!-- Popular Games Section -->
            <section class="mb-8">
                <h2 class="text-2xl font-bold mb-6 text-apple-blue">Popular Games</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="popular-games">
                    <!-- Popular games will be loaded dynamically -->
                </div>
            </section>
            
            <!-- New Games Section -->
            <section class="mb-8">
                <h2 class="text-2xl font-bold mb-6 text-apple-blue">New Games</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="new-games">
                    <!-- New games will be loaded dynamically -->
                </div>
            </section>
        </main>
    </div>

    <footer class="bg-gray-800 text-white">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-wrap justify-between">
                <div class="w-full md:w-1/3 mb-6 md:mb-0">
                    <h2 class="text-xl font-bold mb-4">MiNiFun</h2>
                    <p class="text-gray-400 mb-4">Your ultimate destination for free online games. Play instantly in your browser without downloads.</p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-discord"></i></a>
                    </div>
                </div>
                
                <div class="w-full md:w-1/3 mb-6 md:mb-0">
                    <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">Home</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Top Games</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">New Releases</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Contact Us</a></li>
                    </ul>
                </div>
                
                <div class="w-full md:w-1/3">
                    <h3 class="text-lg font-semibold mb-4">Legal</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">Terms of Service</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Cookie Policy</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-6 text-center">
                <p class="text-gray-400">&copy; 2024 MiNiFun.vip. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- App JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 新的移动菜单逻辑
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileNav = document.getElementById('mobile-nav');
            
            mobileMenuButton.addEventListener('click', function() {
                mobileNav.classList.toggle('hidden');
            });
            
            // 点击移动菜单外区域关闭菜单
            document.addEventListener('click', function(event) {
                if (!mobileNav.contains(event.target) && !mobileMenuButton.contains(event.target) && !mobileNav.classList.contains('hidden')) {
                    mobileNav.classList.add('hidden');
                }
            });
            
            // 设置logo点击事件
            document.getElementById('logo-link').addEventListener('click', function(e) {
                e.preventDefault();
                resetView();
            });
            
            // 确保搜索框初始为空
            document.getElementById('search-input').value = '';
            
            // Initialize language support
            initLanguage();
            
            // Load game data from JSON
            loadGameData();
        });
        
        // Function to fetch and load game data
        async function loadGameData() {
            try {
                const response = await fetch('games.json');
                if (!response.ok) {
                    throw new Error('Failed to load game data');
                }
                
                const data = await response.json();
                
                // 移除加载侧边栏分类的代码
                // 不再调用 loadCategories 函数
                
                // Load all active games
                const activeGames = data.games.filter(game => game.isActive);
                loadGames(activeGames, 'all-games');
                
                // Setup view toggle for all games
                setupViewToggle();
                
                // Load popular games (games with isHot=true)
                const popularGames = activeGames.filter(game => game.isHot);
                loadGames(popularGames, 'popular-games');
                
                // Load new games (games with isNew=true)
                const newGames = activeGames.filter(game => game.isNew);
                loadGames(newGames, 'new-games');
                
                // Load category cards
                loadCategoryCards(data.categories);
                
                // Set up search functionality
                setupSearch(activeGames);
                
            } catch (error) {
                console.error('Error loading game data:', error);
                document.getElementById('all-games').innerHTML = '<p class="text-red-500 p-4">加载游戏数据失败，请稍后再试。</p>';
            }
        }
        
        // 移除不再需要的 loadCategories 函数
        // function loadCategories(categories) {
        //    const categoriesList = document.getElementById('categories-list');
        //    categoriesList.innerHTML = '';
        //    
        //    categories.forEach(category => {
        //        const li = document.createElement('li');
        //        li.innerHTML = `
        //            <a href="#" class="flex items-center text-gray-700 hover:text-apple-blue" data-category="${category.id}">
        //                <i class="${category.icon} mr-2"></i> ${category.name}
        //            </a>
        //        `;
        //        categoriesList.appendChild(li);
        //        
        //        // Add event listener for category filtering
        //        li.querySelector('a').addEventListener('click', function(e) {
        //            e.preventDefault();
        //            filterGamesByCategory(category.id);
        //        });
        //    });
        // }
        
        // Function to load category cards
        function loadCategoryCards(categories) {
            const container = document.getElementById('category-cards');
            container.innerHTML = '';
            
            // 添加 "All" 分类卡片作为第一个元素
            const allCard = document.createElement('div');
            allCard.className = 'bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow';
            
            allCard.innerHTML = `
                <a href="#" class="block" data-category="all">
                    <div class="bg-apple-blue text-white p-3 flex justify-center items-center">
                        <i class="fas fa-th-large text-2xl"></i>
                    </div>
                    <div class="p-2 text-center">
                        <h3 class="font-medium text-sm">All</h3>
                    </div>
                </a>
            `;
            
            container.appendChild(allCard);
            
            // 为All卡片添加点击事件
            allCard.querySelector('a').addEventListener('click', function(e) {
                e.preventDefault();
                resetView();
            });
            
            // 继续添加其他分类卡片
            categories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow';
                
                // Generate random color from apple color palette for each category
                const colors = ['apple-blue', 'apple-green', 'apple-red', 'apple-orange', 'apple-yellow', 'apple-purple', 'apple-pink'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                
                card.innerHTML = `
                    <a href="#" class="block" data-category="${category.id}">
                        <div class="bg-${randomColor} text-white p-3 flex justify-center items-center">
                            <i class="${category.icon} text-2xl"></i>
                        </div>
                        <div class="p-2 text-center">
                            <h3 class="font-medium text-sm">${category.name}</h3>
                        </div>
                    </a>
                `;
                
                container.appendChild(card);
                
                // Add event listener for category filtering
                card.querySelector('a').addEventListener('click', function(e) {
                    e.preventDefault();
                    filterGamesByCategory(category.id);
                });
            });
        }
        
        // Function to load games into a container
        function loadGames(games, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (games.length === 0) {
                container.innerHTML = '<p class="col-span-full text-center text-gray-500">该分类下暂无游戏。</p>';
                return;
            }
            
            games.forEach(game => {
                const gameCard = createGameCard(game);
                container.appendChild(gameCard);
            });
        }
        
        // Function to create a game card
        function createGameCard(game) {
            const gameCard = document.createElement('div');
            gameCard.className = 'game-card bg-white rounded-lg shadow-sm hover:shadow-md overflow-hidden';
            gameCard.setAttribute('data-category', game.category);
            gameCard.setAttribute('data-game-id', game.id);
            
            let badgeHTML = '';
            if (game.isHot) {
                badgeHTML = `<div class="absolute top-2 right-2 bg-apple-red text-white text-xs font-bold px-2 py-0.5 rounded">HOT</div>`;
            } else if (game.isNew) {
                badgeHTML = `<div class="absolute top-2 right-2 bg-apple-green text-white text-xs font-bold px-2 py-0.5 rounded">NEW</div>`;
            }
            
            // Find the category icon from the game.category
            let categoryName = 'Unknown';
            let categoryIcon = 'fas fa-gamepad';
            
            // This would typically come from your categories data
            // For simplicity, we're hard-coding some mappings here
            const categoryMap = {
                'action': { name: 'Action', icon: 'fas fa-gamepad' },
                'shooting': { name: 'Shooting', icon: 'fas fa-crosshairs' },
                'puzzle': { name: 'Puzzle', icon: 'fas fa-puzzle-piece' },
                'strategy': { name: 'Strategy', icon: 'fas fa-chess' },
                'adventure': { name: 'Adventure', icon: 'fas fa-running' },
                'racing': { name: 'Racing', icon: 'fas fa-car' },
                'sports': { name: 'Sports', icon: 'fas fa-futbol' },
                'arcade': { name: 'Arcade', icon: 'fas fa-archway' }
            };
            
            if (categoryMap[game.category]) {
                categoryName = categoryMap[game.category].name || 'Unknown';
                categoryIcon = categoryMap[game.category].icon;
            }
            
            // Determine the game link - use iframeUrl if available, otherwise use detailPage
            const gameUrl = game.iframeUrl ? `game.html?id=${game.id}` : game.detailPage;
            
            gameCard.innerHTML = `
                <div class="relative">
                    <img src="${game.imageUrl}" alt="${game.title}" class="w-full h-36 object-cover">
                    ${badgeHTML}
                </div>
                <div class="p-3">
                    <h3 class="font-bold text-sm mb-1 truncate">${game.title}</h3>
                    <p class="text-gray-600 text-xs mb-2 line-clamp-2 h-8">${game.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500"><i class="${categoryIcon} mr-1"></i> ${categoryName}</span>
                        <a href="${gameUrl}" class="bg-apple-blue text-white text-xs px-2 py-1 rounded hover:bg-blue-600">Play Now</a>
                    </div>
                </div>
            `;
            
            return gameCard;
        }
        
        // Function to filter games by category
        async function filterGamesByCategory(categoryId) {
            try {
                const response = await fetch('games.json');
                if (!response.ok) {
                    throw new Error('Failed to load game data');
                }
                
                const data = await response.json();
                
                // 确保所有部分可见
                document.querySelector('section:nth-child(1)').style.display = 'block';
                document.querySelector('section:nth-child(2)').style.display = 'block';
                document.querySelector('section:nth-child(3)').style.display = 'block';
                document.querySelector('section:nth-child(4)').style.display = 'block';
                
                // 获取与分类匹配的活跃游戏
                const filteredGames = data.games.filter(game => game.isActive && game.category === categoryId);
                
                // 更新所有游戏部分
                document.getElementById('all-games').innerHTML = '';
                
                if (filteredGames.length === 0) {
                    document.getElementById('all-games').innerHTML = '<p class="col-span-full text-center text-gray-500">No games available in this category.</p>';
                } else {
                    // 加载过滤后的游戏
                    loadGames(filteredGames, 'all-games');
                }
                
                // 滚动到筛选结果
                const allGamesSection = document.querySelector('section:nth-child(2)');
                allGamesSection.scrollIntoView({ behavior: 'smooth' });
                
                // 更新分类标题
                const category = data.categories.find(cat => cat.id === categoryId);
                const categoryName = category ? category.name : categoryId;
                document.querySelector('section:nth-child(2) h2').textContent = `${categoryName} All Games`;
                
            } catch (error) {
                console.error('Error filtering games:', error);
            }
        }
        
        // Function to set up search functionality
        function setupSearch(games) {
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            
            // Set search placeholder based on current language
            searchInput.placeholder = 'Search games...';
            
            function performSearch() {
                const searchTerm = searchInput.value.toLowerCase().trim();
                if (searchTerm === '') {
                    // 如果搜索内容为空，重置页面到初始状态
                    resetView();
                    return;
                }
                
                const searchResults = games.filter(game => 
                    game.title.toLowerCase().includes(searchTerm) || 
                    game.description.toLowerCase().includes(searchTerm)
                );
                
                // 先显示所有部分，然后再隐藏 - 防止之前的搜索状态影响当前显示
                document.querySelector('section:nth-child(1)').style.display = 'block'; // 分类部分
                document.querySelector('section:nth-child(2)').style.display = 'block'; // 所有游戏部分
                document.querySelector('section:nth-child(3)').style.display = 'block'; // 热门游戏部分
                document.querySelector('section:nth-child(4)').style.display = 'block'; // 新游戏部分
                
                // 更新所有游戏部分为搜索结果
                document.getElementById('all-games').innerHTML = '';
                
                if (searchResults.length === 0) {
                    const noResultsText = 'No games found matching "%s"';
                    document.getElementById('all-games').innerHTML = `<p class="col-span-full text-center text-gray-500">${noResultsText.replace('%s', searchTerm)}</p>`;
                } else {
                    loadGames(searchResults, 'all-games');
                }
                
                // 隐藏其他部分
                document.querySelector('section:nth-child(1)').style.display = 'none'; // 分类部分
                document.querySelector('section:nth-child(3)').style.display = 'none'; // 热门游戏部分
                document.querySelector('section:nth-child(4)').style.display = 'none'; // 新游戏部分
                
                // 更新搜索结果标题
                const resultsText = 'Search Results for "%s"';
                document.querySelector('section:nth-child(2) h2').textContent = resultsText.replace('%s', searchTerm);
            }
            
            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        }
        
        // Function to reset the view back to default
        function resetView() {
            // 清空搜索框
            document.getElementById('search-input').value = '';
            
            // 显示所有被隐藏的部分
            document.querySelector('section:nth-child(1)').style.display = 'block'; // 分类部分
            document.querySelector('section:nth-child(2)').style.display = 'block'; // 所有游戏部分
            document.querySelector('section:nth-child(3)').style.display = 'block'; // 热门游戏部分
            document.querySelector('section:nth-child(4)').style.display = 'block'; // 新游戏部分
            
            // 重置分类标题
            document.querySelector('section:nth-child(1) h2').textContent = 'Game Categories';
            document.querySelector('section:nth-child(2) h2').textContent = 'All Games';
            document.querySelector('section:nth-child(3) h2').textContent = 'Popular Games';
            document.querySelector('section:nth-child(4) h2').textContent = 'New Games';
            
            // 重新加载所有游戏数据
            loadGameData();
            
            // 滚动回顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Function to setup view toggle (grid/list view)
        function setupViewToggle() {
            const gridViewBtn = document.getElementById('grid-view-btn');
            const listViewBtn = document.getElementById('list-view-btn');
            const allGamesContainer = document.getElementById('all-games');
            
            gridViewBtn.addEventListener('click', function() {
                allGamesContainer.className = 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4';
                gridViewBtn.className = 'bg-apple-blue text-white px-3 py-1 rounded text-sm';
                listViewBtn.className = 'bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm';
            });
            
            listViewBtn.addEventListener('click', function() {
                allGamesContainer.className = 'grid grid-cols-1 gap-4';
                listViewBtn.className = 'bg-apple-blue text-white px-3 py-1 rounded text-sm';
                gridViewBtn.className = 'bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm';
            });
        }
        
        // Function to initialize language settings
        function initLanguage() {
            // 不再需要多语言支持，这个函数现在只是为了兼容性而保留
            // 不做任何事情
        }
        
        // Function to set language - 为兼容性保留但简化
        function setLanguage(lang) {
            // 不做任何事情，因为不再支持多语言
        }
    </script>
</body>
</html> 